<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Agent AI Personal Shopping Assistant</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    .build-info {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 10;
      font-size: 0.7rem;
      font-weight: 500;
      color: #03dac6;
      opacity: 0.7;
      text-shadow: 0 0 5px rgba(3, 218, 198, 0.4);
      pointer-events: none;
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      opacity: 1;
      transform: scale(1);
    }

    .splash-screen.fade-out {
      opacity: 0;
      transform: scale(1.1);
      pointer-events: none;
    }

    .splash-screen::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: ripple 4s infinite;
    }

    @keyframes ripple {
      0% { width: 0; height: 0; opacity: 1; }
      50% { width: 200px; height: 200px; opacity: 0.3; }
      100% { width: 400px; height: 400px; opacity: 0; }
    }

    .typewriter-container {
      text-align: center;
      color: white;
      position: relative;
      z-index: 2;
    }

    .typewriter {
      font-family: 'Georgia', 'Times New Roman', serif;
      font-size: 4rem;
      font-weight: 300;
      font-style: italic;
      letter-spacing: 3px;
      border-right: 3px solid white;
      padding-right: 15px;
      animation: blink-cursor 1.2s infinite;
      text-shadow: 0 0 20px rgba(255,255,255,0.3);
      transform: translateY(20px);
      opacity: 0;
      animation: slideUp 0.8s ease-out 0.5s forwards, blink-cursor 1.2s infinite 1.3s;
    }

    @keyframes slideUp {
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes blink-cursor {
      0%, 50% { border-color: white; }
      51%, 100% { border-color: transparent; }
    }

    .subtitle {
      font-size: 1.3rem;
      opacity: 0;
      margin-top: 1.5rem;
      font-weight: 300;
      letter-spacing: 1px;
      transform: translateY(30px);
      animation: slideUpFade 1.2s ease-out 3.5s forwards;
      text-shadow: 0 0 15px rgba(255,255,255,0.2);
    }

    @keyframes slideUpFade {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .loading-container {
      margin-top: 3rem;
      opacity: 0;
      animation: slideUpFade 1s ease-out 4.5s forwards;
    }

    .loading-text {
      font-size: 0.9rem;
      margin-bottom: 1rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .loading-dots-splash {
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .loading-dots-splash span {
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      animation: wave 1.8s ease-in-out infinite;
      box-shadow: 0 0 10px rgba(255,255,255,0.4);
    }

    .loading-dots-splash span:nth-child(1) { animation-delay: 0s; }
    .loading-dots-splash span:nth-child(2) { animation-delay: 0.3s; }
    .loading-dots-splash span:nth-child(3) { animation-delay: 0.6s; }

    @keyframes wave {
      0%, 40%, 100% {
        transform: translateY(0) scale(1);
        opacity: 0.6;
      }
      20% {
        transform: translateY(-15px) scale(1.2);
        opacity: 1;
      }
    }

    .progress-bar {
      width: 200px;
      height: 2px;
      background: rgba(255,255,255,0.2);
      border-radius: 1px;
      margin: 2rem auto 0;
      overflow: hidden;
      opacity: 0;
      animation: slideUpFade 1s ease-out 5s forwards;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, transparent, white, transparent);
      width: 100%;
      transform: translateX(-100%);
      animation: progress 2s ease-out 5.5s forwards;
    }

    @keyframes progress {
      to {
        transform: translateX(0);
      }
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      width: 75%;
      max-width: 1000px;
      height: 95vh;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px) scale(0.95);
      animation: appEnter 1s ease-out 7.5s forwards;
    }

    @keyframes appEnter {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .header {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: white;
      padding: 1.5rem;
      text-align: center;
    }
    .app-name {
      font-family: 'Georgia', 'Times New Roman', serif;
      font-size: 2.5rem;
      font-weight: 300;
      margin-bottom: 0.3rem;
      letter-spacing: 1px;
      font-style: italic;
    }
    .tagline {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 0.2rem;
      font-weight: 300;
    }
    .motto {
      font-size: 1rem;
      font-weight: 600;
      opacity: 0.95;
      letter-spacing: 1px;
    }
    .main-content {
      display: flex;
      height: calc(95vh - 130px);
      min-height: 500px;
    }
    .chat-section { flex: 2.8; display: flex; flex-direction: column; }
    .agent-panel { flex: 1; background: #f8fafc; border-left: 1px solid #e2e8f0; }
    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      background: #fafafa;
    }
    .message {
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1rem;
    }
    .user-message {
      justify-content: flex-end;
    }
    .message-content {
      max-width: 75%;
      padding: 1rem 1.5rem;
      border-radius: 1.5rem;
      line-height: 1.5;
      font-size: 0.9rem;
    }
    .user-message .message-content {
      background: #4f46e5;
      color: white;
    }
    .bot-message .message-content {
      background: white;
      border: 1px solid #e2e8f0;
    }
    .loading-message .message-content {
      background: #f3f4f6;
      border: 1px solid #e2e8f0;
      color: #6b7280;
    }
    .formatted-text p { margin-bottom: 0.75rem; }
    .formatted-text p:last-child { margin-bottom: 0; }
    .formatted-text ul { margin: 0.75rem 0; padding-left: 1.5rem; }
    .formatted-text li { margin-bottom: 0.25rem; }
    .formatted-text strong { font-weight: 600; color: #1f2937; }
    .loading-dots {
      display: inline-flex;
      gap: 4px;
      align-items: center;
    }
    .loading-dots span {
      width: 6px;
      height: 6px;
      background: #6b7280;
      border-radius: 50%;
      animation: bounce 1.4s infinite;
    }
    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
    .input-section {
      padding: 1.5rem;
      border-top: 1px solid #e2e8f0;
      background: white;
    }
    .input-container {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    #messageInput {
      flex: 1;
      padding: 1rem 1.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 50px;
      outline: none;
      font-size: 0.9rem;
      transition: border-color 0.2s;
    }
    #messageInput:focus {
      border-color: #4f46e5;
    }
    .send-btn {
      padding: 1rem 2rem;
      background: #4f46e5;
      color: white;
      border: none;
      border-radius: 50px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 80px;
      font-size: 0.9rem;
    }
    .send-btn:hover {
      background: #4338ca;
    }
    .send-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .agent-panel h3 {
      padding: 1.2rem;
      background: #e2e8f0;
      font-size: 0.95rem;
      font-weight: 600;
    }
    .agent-status {
      padding: 1.2rem;
    }
    .agent {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: white;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
    }
    .agent-icon {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      font-size: 0.85rem;
      flex-shrink: 0;
    }
    .search-agent { background: #10b981; }
    .inventory-agent { background: #f59e0b; }
    .recommendation-agent { background: #8b5cf6; }
    .agent-info h4 {
      font-weight: 600;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    .agent-info p {
      font-size: 0.8rem;
      color: #6b7280;
      line-height: 1.3;
    }
    .workflow-info {
      margin-top: 1rem;
      padding: 1rem;
      background: #eff6ff;
      border-radius: 10px;
      border-left: 4px solid #3b82f6;
    }
    .workflow-info h4 {
      color: #1e40af;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    .actions {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .action-btn {
      padding: 0.5rem 1rem;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 20px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .action-btn:hover {
      background: #e5e7eb;
    }

    @media (max-width: 768px) {
      .typewriter { font-size: 3rem; }

      .build-info {
        top: 10px;
        left: 10px;
        font-size: 0.6rem;
      }

      body {
        padding: 0.5rem;
        align-items: flex-start;
        padding-top: 1rem;
      }

      .container {
        width: 100%;
        max-width: none;
        border-radius: 15px;
        height: 95vh;
      }

      .header {
        padding: 1.5rem;
      }

      .app-name {
        font-size: 2rem;
      }

      .main-content {
        flex-direction: column;
        height: calc(95vh - 180px);
        min-height: 400px;
      }

      .chat-section {
        order: 1;
      }

      .agent-panel {
        order: 2;
        border-left: none;
        border-top: 1px solid #e2e8f0;
        max-height: 250px;
        overflow-y: auto;
      }

      .chat-container {
        height: calc(60vh - 150px);
        padding: 1rem;
        min-height: 250px;
      }

      .message-content {
        max-width: 85%;
      }

      .input-section {
        padding: 1rem;
      }

      .input-container {
        gap: 0.75rem;
      }

      #messageInput {
        padding: 0.875rem 1.25rem;
        font-size: 16px;
      }

      .send-btn {
        padding: 0.875rem 1.5rem;
        min-width: 70px;
      }

      .agent-panel h3 {
        padding: 1rem;
      }

      .agent-status {
        padding: 1rem;
      }

      .agent {
        padding: 0.75rem;
      }

      .agent-icon {
        width: 35px;
        height: 35px;
      }
    }

    @media (max-width: 480px) {
      .typewriter { font-size: 2.5rem; }
      .subtitle { font-size: 1.1rem; }

      .app-name {
        font-size: 1.8rem;
      }

      .tagline {
        font-size: 0.85rem;
      }

      .message-content {
        max-width: 90%;
        padding: 0.875rem 1.25rem;
      }

      .chat-container {
        height: calc(50vh - 120px);
        padding: 0.75rem;
        min-height: 200px;
      }

      .input-section {
        padding: 0.75rem;
      }

      .send-btn {
        padding: 0.875rem 1.25rem;
        font-size: 0.85rem;
      }

      .actions {
        gap: 0.375rem;
      }

      .action-btn {
        padding: 0.5rem 0.875rem;
        font-size: 0.75rem;
      }

      .agent-info h4 {
        font-size: 0.85rem;
      }

      .agent-info p {
        font-size: 0.75rem;
      }
    }

    @media (max-width: 320px) {
      .header {
        padding: 1rem;
      }

      .app-name {
        font-size: 1.5rem;
      }

      .chat-container {
        height: calc(45vh - 100px);
        min-height: 180px;
      }

      .input-container {
        flex-direction: column;
        gap: 0.5rem;
      }

      #messageInput {
        width: 100%;
      }

      .send-btn {
        width: 100%;
        justify-self: stretch;
      }
    }
  </style>
</head>
<body>
<div class="build-info">
  <span>Build Date: <span id="buildDate">Loading...</span></span>
</div>

<div class="splash-screen" id="splashScreen">
  <div class="typewriter-container">
    <div class="typewriter" id="typewriter"></div>
    <div class="subtitle">Multi-agent AI shopping assistant</div>
    <div class="loading-container">
      <div class="loading-text">Initializing</div>
      <div class="loading-dots-splash">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="header">
    <h1 class="app-name">Céleste</h1>
    <p class="tagline">Your intelligent multi-agent personal shopping assistant</p>
    <p class="motto">Shop smarter</p>
  </div>

  <div class="main-content">
    <div class="chat-section">
      <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
          <div class="message-content formatted-text">
            <p>Hello! I'm Céleste, here to help you find exactly what you're looking for by searching our products, checking availability, and suggesting items you might love. Let's Go ! ❤️</p>
          </div>
        </div>
      </div>

      <div class="input-section">
        <div class="input-container">
          <input type="text" id="messageInput" placeholder="Show me smart casual tops for work..." />
          <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
      </div>
    </div>

    <div class="agent-panel">
      <h3>Multi-AI Agents Working</h3>
      <div class="agent-status">
        <div class="agent">
          <div class="agent-icon search-agent">S</div>
          <div class="agent-info">
            <h4>Product Search</h4>
            <p>Analyses queries & finds products</p>
          </div>
        </div>

        <div class="agent">
          <div class="agent-icon inventory-agent">I</div>
          <div class="agent-info">
            <h4>Stock Check</h4>
            <p>Monitors stock & demand patterns</p>
          </div>
        </div>

        <div class="agent">
          <div class="agent-icon recommendation-agent">R</div>
          <div class="agent-info">
            <h4>Suggestions</h4>
            <p>Generates personalised recommendations</p>
          </div>
        </div>

        <div class="workflow-info" id="workflowInfo" style="display: none;">
          <h4>Active Workflow</h4>
          <p id="workflowDetails">No active workflow</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function setBuildDate() {
    const now = new Date();
    const buildDate = now.toLocaleDateString('en-GB', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    }) + ' ' + now.toLocaleTimeString('en-GB', {
      hour: '2-digit',
      minute: '2-digit'
    });

    const customVersion = 'Ver: V11';
    document.getElementById('buildDate').textContent = buildDate + ' | ' + customVersion;
  }
  setBuildDate();

  const text = "Céleste";
  const typewriterElement = document.getElementById('typewriter');
  const splashScreen = document.getElementById('splashScreen');
  let i = 0;

  function typeWriter() {
    if (i < text.length) {
      typewriterElement.textContent += text.charAt(i);
      i++;
      setTimeout(typeWriter, 150);
    } else {
      setTimeout(() => {
        splashScreen.classList.add('fade-out');
        setTimeout(() => {
          splashScreen.style.display = 'none';
        }, 1500);
      }, 3000);
    }
  }

  setTimeout(typeWriter, 1000);

  let isProcessing = false;

  const placeholders = [
    "Show me smart casual tops for work...",
    "Need a leet pair of Sneakers...",
    "Show me summer dresses...",
    "Find me some crisp snapback hats...",
    "I need boots for winter...",
    "Do you have any leather jackets in stock?...",
    "Any RayBan stunner shades?...",
    "I want a bag for work..."
  ];

  let currentPlaceholder = 0;
  const messageInput = document.getElementById('messageInput');

  function rotatePlaceholder() {
    if (!messageInput.value && !isProcessing) {
      messageInput.placeholder = placeholders[currentPlaceholder];
      currentPlaceholder = (currentPlaceholder + 1) % placeholders.length;
    }
  }

  setInterval(rotatePlaceholder, 3000);

  function formatText(text) {
    return text
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\* ([^\n]*)/g, '<li>$1</li>')
      .replace(/(<li>.*?<\/li>\s*)+/g, '<ul>$&</ul>')
      .split('\n\n')
      .map(paragraph => paragraph.trim() ? `<p>${paragraph.replace(/\n/g, ' ')}</p>` : '')
      .filter(paragraph => paragraph)
      .join('');
  }

  async function sendMessage() {
    if (isProcessing) return;

    const input = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const message = input.value.trim();
    if (!message) return;

    addMessage(message, true);
    input.value = '';

    isProcessing = true;
    sendBtn.disabled = true;
    sendBtn.textContent = 'Thinking...';

    const loadingMessageId = addLoadingMessage();

    try {
      const response = await fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          query: message,
          user_id: 'demo_user'
        })
      });

      const data = await response.json();

      removeLoadingMessage(loadingMessageId);
      addMessage(data.message, false);

      if (data.agent_path && data.workflow_id) {
        updateWorkflowInfo(data.agent_path, data.workflow_id, data.personalized);
      }

      if (data.actions) {
        addActions(data.actions);
      }

    } catch (error) {
      removeLoadingMessage(loadingMessageId);
      addMessage('Sorry, I encountered an error. Please try again.', false);
    } finally {
      isProcessing = false;
      sendBtn.disabled = false;
      sendBtn.textContent = 'Send';
    }
  }

  function addMessage(text, isUser) {
    const container = document.getElementById('chatContainer');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;

    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content formatted-text';

    if (isUser) {
      contentDiv.textContent = text;
    } else {
      contentDiv.innerHTML = formatText(text);
    }

    messageDiv.appendChild(contentDiv);
    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
  }

  function addLoadingMessage() {
    const container = document.getElementById('chatContainer');
    const messageDiv = document.createElement('div');
    const messageId = 'loading-' + Date.now();
    messageDiv.id = messageId;
    messageDiv.className = 'message bot-message loading-message';

    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';
    contentDiv.innerHTML = `
                  Thinking
                  <div class="loading-dots">
                      <span></span>
                      <span></span>
                      <span></span>
                  </div>
              `;

    messageDiv.appendChild(contentDiv);
    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;

    return messageId;
  }

  function removeLoadingMessage(messageId) {
    const loadingMessage = document.getElementById(messageId);
    if (loadingMessage) {
      loadingMessage.remove();
    }
  }

  function updateWorkflowInfo(agentPath, workflowId, personalized) {
    const workflowInfo = document.getElementById('workflowInfo');
    const workflowDetails = document.getElementById('workflowDetails');

    const agentNames = agentPath.map(agent => {
      const name = agent.replace('_agent', '').replace('_', ' ');
      return name.charAt(0).toUpperCase() + name.slice(1);
    }).join(' → ');

    workflowDetails.innerHTML = `
                  <strong>Path:</strong> ${agentNames}<br>
                  <strong>ID:</strong> ${workflowId.slice(-8)}<br>
                  <strong>Personalised:</strong> ${personalized ? 'Yes' : 'No'}
              `;

    workflowInfo.style.display = 'block';

    document.querySelectorAll('.agent').forEach(agent => {
      agent.style.transform = 'scale(1)';
      agent.style.transition = 'transform 0.3s';
    });

    agentPath.forEach((agentType, index) => {
      setTimeout(() => {
        const agentClass = agentType.replace('_', '-');
        const agentElement = document.querySelector(`.${agentClass}`);
        if (agentElement) {
          const agentContainer = agentElement.closest('.agent');
          agentContainer.style.transform = 'scale(1.05)';
          setTimeout(() => {
            agentContainer.style.transform = 'scale(1)';
          }, 500);
        }
      }, index * 300);
    });
  }

  function addActions(actions) {
    const container = document.getElementById('chatContainer');
    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'actions';

    actions.forEach(action => {
      const btn = document.createElement('button');
      btn.className = 'action-btn';
      btn.textContent = action;
      btn.onclick = () => {
        document.getElementById('messageInput').value = action;
      };
      actionsDiv.appendChild(btn);
    });

    container.appendChild(actionsDiv);
    container.scrollTop = container.scrollHeight;
  }

  document.getElementById('messageInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !isProcessing) sendMessage();
  });

  messageInput.addEventListener('focus', () => {
    currentPlaceholder = 0;
  });
</script>
</body>
</html>
